buildscript {
    ext {
        springBootVersion = '2.0.0.RC2'
    }

    repositories {
        maven {
            url 'https://repo.spring.io/milestone/'
            name 'spring-milestones'
        }
        jcenter()
    }

    dependencies {
        classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
    }
}

allprojects {
    group 'com.gitlab.maly'
    version '1.0-SNAPSHOT'
}


subprojects {
    repositories {
        maven {
            url 'https://repo.spring.io/milestone/'
            name 'spring-milestones'
        }
        jcenter()
    }
}

configure(subprojects.findAll { it.plugins.withType(JavaPlugin) }) {
    sourceCompatibility = 1.8
    targetCompatibility = 1.8
}

task dockerComposeUp(type: Exec) {
    environment 'MYSQL_USER', "${System.properties['MYSQL_USER']}"
    environment 'MYSQL_PASSWORD', "${System.properties['MYSQL_PASSWORD']}"
    environment 'MYSQL_ROOT_PASSWORD', "${System.properties['MYSQL_ROOT_PASSWORD']}"
    environment 'MONGODB_USER', "${System.properties['MONGODB_USER']}"
    environment 'MONGODB_PASSWORD', "${System.properties['MONGODB_PASSWORD']}"
    
    commandLine 'docker-compose', 'up', '-d'
}

task dockerComposeDown(type: Exec) {
    commandLine 'docker-compose', 'down'
}

dockerComposeUp.mustRunAfter dockerComposeDown
